language: rust
cache: cargo
rust:
- stable
- nightly
matrix:
  fast_finish: true
  allow_failures:
  - rust: nightly
  include:
  - os: osx
    env: TARGET=x86_64-apple-darwin
  - os: linux
    env: 
    - TARGET=x86_64-unknown-linux-gnu CARGO_RELEASE=true
    - secure: "aIVp1J36FWY6tXK25u5+qgzPN32/6pVNPgqc+nZujYSlB2v4Mon+63FO6cq1bbf0j8Lxz2SX816L7ta8iOq3BQbVG62Gs2hAcTiZN5DhrybOTqUU51DMqq4tbr5JdNcnI9iJbnnIcVNsMZ3bjdDwhj+3maUQ9p3JvPi+GqBq9XBN2i79DNp5+qFQh2Ug/6tdjsX+JVYelOnCvR3i4r+vuPrrCJ9UL0BqIcsjIbPq1SIMYHfY543Y72f0V1uvcGJbI1MvB7wQIUKSsFYuFofBHE95EiaSoiJE2M2ZpW0NpHBDH2yxkBd5SbAg+Vw53r4PuZ/KjNNHxDVbb065tFuV2PUUY79GZGCL8QChFqyqf/eFoOTDsT8In64kzQ+d8w074W23kt16Bcw+j3Oe75dFvzHB3rG1QEw05AEuBCWN39YtUBFB8Y2tZ2Nvd/Kcl+KLTYJcniOpU1R9rcN6ClxTR9NEiCC2gV1YozXwU1JEAKWpuNDZq1xvRNsOhoESJY05nQjF93e6lkueT0tGk9lxpdLwKcC6pVfnIPbmC8gI5q64Dnr1Rw0KCra2cvxq1ZkpJWQPxoW+g87Xw5gWYoaLIE0rX9Xtez5nQVeMl0t+KbuHKf7oALfkj82gnj1RX8ASaaPmyfi0bVahhyxb7ApbxPb0PoI9hjaftmz2BV8NhoA="
#  - os: linux
#    env: TARGET=x86_64-unknown-linux-musl
script: make build
deploy:
- provider: releases
  api_key:
    secure: "JBdhuIRxaAordv2aAVXOfxdhhSz47KcJvTqqgXA+VAnRRwOIkrxkgVMg0WrQFcg5HbuXfHiwYBaYtgpILUHmN05lnlH8iSv7tfA25dIOcFMDaxWPpnXvlfBLasaskxZc+OwMyZcKeNw05He/8rRQIWjsAffNGUHdnbVsHuVXyStElOWCwp9cpuSel9FYTanlDWV3HgtoCLmoFClxIAwnBfhIaJaMrhcGEAqH1tjNNuq4dY9Rv01WAEtvFlexcgoSKE+pKgSx06noGR/uw3YwTK1b4b4CA+N3G++ixnlHgaBBcCW+Su8OeUOzO3dgrAFM3BreXbItBsnAla8sM+MxaXYtoz0MufSNf0FSemeT0r9kq4sA+ffgLhGQagBI7FA4RburFBxpovxRX9P8pjBsoGrdgWT3JzeDr+YOPkd6rlWQ7F/Z7/stDOVTXZx2wxw7UpHLroo29F3GizclZRuNh1CVxpZxB+dU0FFzoluVBx448D1gm0WrLZ1BfNbGHTE/Do4qYkGS4IdFYmdkB3e+fi+fKlVpCSpgm/BpPmMAwJw8we6frVCWYv/JW7SYW9n3ZEXiGWQsgScgYk+DBUpTn9k2YijPBdl+v1K0VwqB+GLgnegoRozbUxf7WgV3J4KtVfXxfZ2/TZKsGsNF9vqP7QrjfDBjWiG1UkmAEJ6RMLw="
  file: dist/sdoc-${TRAVIS_TAG}-${TARGET}.tar.gz
  skip_cleanup: true
  on:
    repo: matthewwoodruff/sdoc
    tags: true
    condition: "$TRAVIS_RUST_VERSION = stable && $TARGET != ''"
- provider: script
  script: make cargo-release
  skip_cleanup: true
  on:
    repo: matthewwoodruff/sdoc
    tags: true
    condition: "$CARGO_RELEASE = true"
