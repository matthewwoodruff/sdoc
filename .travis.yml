language: rust
cache: cargo
rust:
- stable
- nightly
matrix:
  fast_finish: true
  allow_failures:
  - rust: nightly
  include:
  - os: osx
    env: TARGET=x86_64-apple-darwin
  - os: linux
    env: 
    - TARGET=x86_64-unknown-linux-gnu CARGO_RELEASE=true
    - secure: "XU6lsbfKQAUByYp/TIFFk/eFhktOU8x5YIBZMwy77reRcZTd8LPMJpop5zWhBhsUAW9Hz78G2Cl1xojp8KGWeNi996/PmwPaRgsfCrVrbSIn077qdqgdh+OOJwn9eBwADlkg8sy917PorRV/aEK+nPrcKPYw0rMZtVOQXT2JvRrSzfQihpnDUfdcml17Whsy/esXeP8gy4GGDyWO7AgytH8q56PEaJbejCMa2oeNtJ4nQ4nxM8qAcxMcYyNDzDdRpAHf6RxTm/FdRP1vc25mrr9qPQ2ZcHS2a+NpSlHPxgXJi45mU3UgUk8/kDfk0lNjMEUC2JamWRmZIfrtJQdj5x3/4CNbLGHrb8hapeL4NxTOaY4naNer53ea3hjheO7FMZW5gpa88GaMG0D+erMBGpvvqBzpMd5osdzWyKhd/D12okaoKuQHY7xRICmE79AHHB3+Vl6QEFyKoBo6QJ6cb5T3skUKd1r4/E/ojQcRftdf9D0z3u8eMASaqBTecgfmDm+834D/wTDcy9cyAV1k/3YY6ddXaugWCWkCZE/+3U8MLjanvCAMZPcdAshNBKS1GZotFD8qN/8D1w8yq5+xehGLA6EyidmPSqhjuht8w8fYQKjDw80QchSWC+ntx2F+881XFFQo8y/nDsHMEDRSBs0fY8KwTcO1Pi0ZMML5XfY="
#  - os: linux
#    env: TARGET=x86_64-unknown-linux-musl
script: make build
deploy:
- provider: releases
  api_key:
    secure: "JBdhuIRxaAordv2aAVXOfxdhhSz47KcJvTqqgXA+VAnRRwOIkrxkgVMg0WrQFcg5HbuXfHiwYBaYtgpILUHmN05lnlH8iSv7tfA25dIOcFMDaxWPpnXvlfBLasaskxZc+OwMyZcKeNw05He/8rRQIWjsAffNGUHdnbVsHuVXyStElOWCwp9cpuSel9FYTanlDWV3HgtoCLmoFClxIAwnBfhIaJaMrhcGEAqH1tjNNuq4dY9Rv01WAEtvFlexcgoSKE+pKgSx06noGR/uw3YwTK1b4b4CA+N3G++ixnlHgaBBcCW+Su8OeUOzO3dgrAFM3BreXbItBsnAla8sM+MxaXYtoz0MufSNf0FSemeT0r9kq4sA+ffgLhGQagBI7FA4RburFBxpovxRX9P8pjBsoGrdgWT3JzeDr+YOPkd6rlWQ7F/Z7/stDOVTXZx2wxw7UpHLroo29F3GizclZRuNh1CVxpZxB+dU0FFzoluVBx448D1gm0WrLZ1BfNbGHTE/Do4qYkGS4IdFYmdkB3e+fi+fKlVpCSpgm/BpPmMAwJw8we6frVCWYv/JW7SYW9n3ZEXiGWQsgScgYk+DBUpTn9k2YijPBdl+v1K0VwqB+GLgnegoRozbUxf7WgV3J4KtVfXxfZ2/TZKsGsNF9vqP7QrjfDBjWiG1UkmAEJ6RMLw="
  file: dist/sdoc-${TRAVIS_TAG}-${TARGET}.tar.gz
  skip_cleanup: true
  on:
    repo: matthewwoodruff/sdoc
    tags: true
    condition: "$TRAVIS_RUST_VERSION = stable && $TARGET != ''"
- provider: script
  script: make cargo-release
  skip_cleanup: true
  on:
    repo: matthewwoodruff/sdoc
    tags: true
    condition: "$CARGO_RELEASE = true"
